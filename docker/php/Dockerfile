# /docker/php/Dockerfile (æ—¢å­˜ã®å†…å®¹ã«Node.jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¿½åŠ )
FROM php:8.4-fpm

# ğŸš¨ Node.jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¿½åŠ  ğŸš¨
# Nuxt SSRã®ãŸã‚ã«Node.jsã¨npmãŒå¿…è¦ã§ã™ã€‚
COPY --from=node:20-slim /usr/local/bin/node /usr/local/bin/
COPY --from=node:20-slim /usr/local/lib/node_modules /usr/local/lib/node_modules
RUN ln -s /usr/local/lib/node_modules/npm/bin/npm-cli.js /usr/local/bin/npm

# å¿…è¦ãªã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨PHPæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (æ—¢å­˜ã®å†…å®¹)
RUN apt update \
  # å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  && apt install -y git default-mysql-client zlib1g-dev libzip-dev libpng-dev libjpeg-dev libwebp-dev unzip \
  # ä¾å­˜é–¢ä¿‚ã®ãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
  && rm -rf /var/lib/apt/lists/* \
  && docker-php-ext-configure gd --with-jpeg --with-webp \
  && docker-php-ext-install -j$(nproc) gd pdo_mysql zip bcmath 

# Composerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (æ—¢å­˜ã®å†…å®¹)
COPY --from=composer:2 /usr/bin/composer /usr/local/bin/composer
# ... (MailHog, wait-for-it, php.iniã®ã‚³ãƒ”ãƒ¼ã¯ãã®ã¾ã¾)

# ãƒ¯ãƒ¼ã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š
WORKDIR /var/www