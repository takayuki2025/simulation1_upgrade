server {
    listen 80;
    listen [::]:80;

    # ğŸš¨ ä¿®æ­£: Nginxã®rootã‚’Laravelã®publicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¨­å®š ğŸš¨
    # ã“ã‚Œã«ã‚ˆã‚Š /index.php ãŒæ­£ã—ãè§£æ±ºã•ã‚Œã‚‹
    root /var/www/backend/public; 
    index index.php;

    # Gzipåœ§ç¸®è¨­å®š (çœç•¥) ...

    # ================================================
    # 1. Nuxté™çš„ã‚¢ã‚»ãƒƒãƒˆã®é…ä¿¡ (ä¾‹: /_nuxt/)
    # ================================================
    # Nuxtã®ãƒ“ãƒ«ãƒ‰æˆæœç‰©ï¼ˆCSS/JS/ç”»åƒãªã©ï¼‰ã®ãƒ‘ã‚¹ã‚’ç›´æ¥æŒ‡å®šã—ã¦é…ä¿¡ã™ã‚‹
    location ~ ^/(_nuxt/|favicon.ico) {
        # ğŸš¨ ä¿®æ­£: Nuxtã®ãƒ“ãƒ«ãƒ‰æˆæœç‰©ãŒã‚ã‚‹ãƒ‘ã‚¹ã‚’ç›´æ¥ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§æŒ‡å®š ğŸš¨
        # phpã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹ ./frontend/.output/public ã¨åŒã˜å ´æ‰€
        alias /var/www/frontend/public/$1; 
        try_files $uri =404;
    }

    # ================================================
    # 2. SSRã¨APIã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    # ================================================
    location / {
        # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã€Laravelã®index.phpã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¸¡ã™
        # rootãŒ /var/www/backend/public ã®ãŸã‚ã€/index.php ã¯æ­£ã—ãè§£æ±ºã•ã‚Œã‚‹
        try_files $uri $uri/ /index.php$is_args$args;
    }

    # ================================================
    # 3. index.php ã®å‡¦ç†ï¼ˆFastCGIãƒ—ãƒ­ã‚­ã‚·ï¼‰
    # ================================================
    location ~ ^/index.php(/|$) {
        fastcgi_pass php:9000;
        
        fastcgi_read_timeout 300; 
        fastcgi_send_timeout 300;
        
        # FastCGIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®š
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}